# =====================================================
# ğŸ”¥ ROUTING DINAMICO â€“ RIP e OSPF (FRRouting)
# =====================================================
# Basato sui laboratori KatharÃ  â€“ Roma Tre University
# =====================================================


# =====================================================
# ğŸ§­ SEZIONE DIAGNOSTICA OSPF (COMANDI PRINCIPALI)
# =====================================================

# 1ï¸âƒ£ VEDERE Lâ€™ID DEL ROUTER (Router ID)
show ip ospf
# â†’ Mostra lâ€™ID del router (Router ID), le aree a cui appartiene,
#   i timer e lo stato generale del processo OSPF.
#   Il Router ID Ã¨ un identificatore unico (di solito lâ€™IP piÃ¹ alto tra le interfacce attive).
#   Serve a distinguere i router nel database LSDB.

# 2ï¸âƒ£ VEDERE IL DESIGNATED ROUTER (DR) E BACKUP DR (BDR) DI UNA RETE/LAN
show ip ospf interface
# â†’ Mostra, per ogni interfaccia:
#   - Il costo OSPF
#   - I timer Hello/Dead
#   - Lo stato dellâ€™interfaccia (DR, BDR, DROther)
#   - Lâ€™ID del DR e del BDR eletti su quella rete.
#   Il DR Ã¨ il router che gestisce la diffusione degli LSAs nella LAN.

# 3ï¸âƒ£ VEDERE LE ENTRY DI DEFAULT (0.0.0.0/0)
show ip route
# â†’ Mostra tutte le rotte conosciute dal router.
#   Le righe con â€œ0.0.0.0/0â€ indicano la *default route*,
#   cioÃ¨ la via usata per raggiungere destinazioni sconosciute.
#   Queste entry le hanno i **router interni** (detti *internal routers*),
#   che ricevono la default route dai router di confine (ABR o ASBR)
#   quando lâ€™area Ã¨ di tipo *stub* o *no-summary*.

# 4ï¸âƒ£ VEDERE I VICINI OSPF
show ip ospf neighbor
# â†’ Mostra tutti i *neighbor* OSPF conosciuti,
#   con il loro ID, stato e interfaccia.
#   âš ï¸ Mostra le caratteristiche dei tuoi *vicini*, non del tuo router.
#   â€œFullâ€ = adiacenza completa, scambio di LSAs terminato.


# =====================================================
# ğŸ”¹ CONFIGURAZIONE OSPF (FRRouting)
# =====================================================

# Attivare OSPF su unâ€™interfaccia
interface ethX
    ip ospf area <id_area>
# â†’ Abilita OSPF sullâ€™interfaccia e la assegna allâ€™area indicata.

# Impostare il costo OSPF
interface eth1
    ospf cost 100
# â†’ Modifica il costo manualmente (default 10). PiÃ¹ alto = meno preferito.

# Aggiungere rotta statica nel kernel
ip route add 20.0.0.0/16 via 10.0.0.2 dev eth0
# â†’ Inserisce una rotta statica di sistema.
#   Se vuoi che OSPF la annunci, aggiungi anche:
#       redistribute kernel

# Aggiungere rotta statica tramite FRR
ip route <rete_dest> <gateway>
# â†’ Variante interna a FRRouting, valida nel file di configurazione.

# Visualizzare le interfacce OSPF
show ip ospf interface
# â†’ Mostra DR/BDR, costi, timer e stato.

# Controllare i vicini OSPF
show ip ospf neighbor
# â†’ Elenca i router connessi via OSPF (stato â€œFullâ€ = connessione OK).

# Visualizzare la tabella OSPF
show ip ospf route
# â†’ Elenca le rotte intra-area, inter-area, e esterne (E1/E2).

# Mostrare il database OSPF
show ip ospf database
# â†’ Visualizza il Link State Database completo.

# Analizzare LSAs
show ip ospf database router
show ip ospf database network
show ip ospf database summary
show ip ospf database asbr-summary

# Ridistribuire rotte da altri protocolli
redistribute connected
redistribute static
redistribute kernel
redistribute bgp metric-type 2 metric 495

# =====================================================
# ğŸ”¹ MULTIAREA OSPF
# =====================================================

# â–ª Router di backbone:
#       network <rete_punto_punto> area 0.0.0.0
# â–ª Router interni (solo area secondaria):
#       network <rete_di_appartenenza> area <id_area>
# â–ª Router di confine (ABR):
#       network <rete_punto_punto> area 0.0.0.0
#       network <rete_di_appartenenza> area <id_area>
# âš ï¸ IMPORTANTE:
#   - I router interni collegati alla backbone devono configurare sia
#     la rete punto-punto (verso la backbone)
#     sia la rete interna della loro area.
#   - I router solo backbone configurano solo la rete punto-punto.
#   - I router solo interni mettono solo la rete di appartenenza.

# Tipi di area
area 1.1.1.1 stub
area 1.1.1.1 stub no-summary
# â†’ â€œstubâ€ = non riceve rotte esterne
#   â€œno-summaryâ€ = riceve solo la default route 0.0.0.0/0

# =====================================================
# ğŸ”¹ RIP (Routing Information Protocol)
# =====================================================

router rip
 network 100.1.0.0/16
 log file /var/log/frr/frr.log
# â†’ Attiva RIP su tutte le interfacce comprese nel prefisso.

systemctl start frr
# â†’ Avvia i demoni FRR (tra cui ripd).

ip route
# â†’ Prima dellâ€™avvio: solo rotte dirette.
#   Dopo lâ€™avvio: compaiono le rotte RIP (proto rip).

ping <ip>
# â†’ Verifica connettivitÃ .

tcpdump -n -i ethX -v
# â†’ Mostra pacchetti RIPv2 (224.0.0.9 UDP 520).

vtysh
# â†’ Entra nella CLI FRR.

show ip rip
# â†’ Mostra le rotte apprese via RIP, metriche e tempi.

ip route add 100.1.0.0/16 via 100.2.0.1
# â†’ Aggiunge rotta statica nel kernel (per Internet o router esterno).
#   Per diffonderla in RIP: redistribute kernel

ip route add default via 100.2.0.2
# â†’ Default route per uscire verso lâ€™esterno.

# Propagare la default in RIP
vtysh
configure
 router rip
  route 0.0.0.0/0
 exit
exit
# â†’ Propaga la default route a tutta la rete RIP.

ip link set ethX down
# â†’ Simula guasto (RIP si aggiorna dopo timeout ~180s).

traceroute <ip>
# â†’ Verifica percorso e riconvergenza.

# â€œredistribute connectedâ€
# â†’ RIP pubblica di default le reti direttamente connesse alle interfacce attive in RIP.
#   Con â€œredistribute connectedâ€ le forza tutte.


# =====================================================
# ğŸ”¹ NOTE FINALI E CONCETTI CHIAVE
# =====================================================

# â–ª COSTI OSPF:
#   Cost = Reference_BW / Interface_BW  (Default Reference_BW = 100 Mbps)

# â–ª TIPI DI PERCORSO OSPF:
#   1. Intra-area â†’ dentro la stessa area
#   2. Inter-area â†’ tra aree (via ABR)
#   3. External Type 1 â†’ costo totale
#   4. External Type 2 â†’ solo costo esterno

# â–ª TIPI DI ROUTER:
#   - Internal Router â†’ tutte le interfacce nella stessa area
#   - Backbone Router â†’ connesso allâ€™area 0
#   - ABR â†’ collega unâ€™area alla backbone
#   - ASBR â†’ collega OSPF a un altro protocollo (es. BGP)

# â–ª RIP:
#   - Distanza vettoriale (hop count max 15)
#   - Aggiornamenti ogni 30s
#   - Redistribuzione: connected, static, kernel

# â–ª OSPF:
#   - Link-state, convergenza rapida
#   - Algoritmo di Dijkstra
#   - Supporta multi-area e gerarchia
